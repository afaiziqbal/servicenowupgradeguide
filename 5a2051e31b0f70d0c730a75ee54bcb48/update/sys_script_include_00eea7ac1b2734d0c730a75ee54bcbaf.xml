<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_orsted_upgrade.GenerateBackupUpdateSet</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>GenerateBackupUpdateSet</name>
        <script><![CDATA[var GenerateBackupUpdateSet = Class.create();
GenerateBackupUpdateSet.prototype = {
	initialize: function() {
	},
	getUpdateSet: function(upgrade_record,version,query){
		var gr = new GlideRecord('sys_update_set');
		gr.addEncodedQuery(query);
		gr.query();
		while(gr.next()){
			var updateSetName = gr.sys_created_by+ " - "+gr.name;
			this.generateUpdateSet(upgrade_record,version,'sys_update_set',updateSetName,gr);
		}
	},


	generateUpdateSet: function(upgrade_record,version,table,backup_record_name,backup_record_obj) {
		var updateSetExport = new UpdateSetExport();
		var sysid = updateSetExport.exportUpdateSet(current);

		var request  = new sn_ws.RESTMessageV2();        
		request.setHttpMethod('get');
		var tablename = 'x_orsted_upgrade_upgrade_guide',
			response,            
			httpResponseStatus,             
			filename =version + ' - ' + table + " - " +backup_record_name;
		var instanceURL = gs.getProperty('glide.servlet.uri');
		request.setEndpoint(instanceURL +"export_update_set.do?sysparm_sys_id=" + sysid + "&sysparm_delete_when_done=true");   
		request.setBasicAuth('UpgradeAdmin', gs.getProperty('x_orsted_upgrade.orsted.upgrade_guide.user'));

		request.saveResponseBodyAsAttachment(tablename, upgrade_record, filename);        
		this.updateForm(upgrade_record,filename);
		response = request.execute();        
		httpResponseStatus = response.getStatusCode();  

		gs.info(" http response status_code:  " + httpResponseStatus);    
	},

	type: 'GenerateBackupUpdateSet'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>AHMAS</sys_created_by>
        <sys_created_on>2021-10-29 05:52:53</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>00eea7ac1b2734d0c730a75ee54bcbaf</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>GenerateBackupUpdateSet</sys_name>
        <sys_package display_value="Upgrade Guide" source="x_orsted_upgrade">5a2051e31b0f70d0c730a75ee54bcb48</sys_package>
        <sys_policy>read</sys_policy>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Upgrade Guide">5a2051e31b0f70d0c730a75ee54bcb48</sys_scope>
        <sys_update_name>sys_script_include_00eea7ac1b2734d0c730a75ee54bcbaf</sys_update_name>
        <sys_updated_by>AHMAS</sys_updated_by>
        <sys_updated_on>2021-10-29 05:52:53</sys_updated_on>
    </sys_script_include>
</record_update>
